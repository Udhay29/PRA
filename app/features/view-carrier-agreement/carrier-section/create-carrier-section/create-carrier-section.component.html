<div class="ui-g-12 pad0 dropshadow split-container">
  <div class="split-header">
    <span class="title">Create Section</span>
    <button class="font16 icon-button icon-Menu_Close close-position" (click)="onClickCancel()"></button>
  </div>
  <div class="split-body">
    <form [formGroup]="createSectionModel.carrierSectionForm">
      <div class="ui-g-12 ui-md-12 ui-lg-12 field-space pad-right0">
        <span class="ui-float-label ui-md-6 ui-lg-6 ui-g-6 typeahead-float pad-left0">
          <p-autoComplete formControlName="carrierSegment" name="carrierSegment" [suggestions]="createSectionModel.carrierSegmentFilteredList"
          size="70" [forceSelection]="true" spellcheck="false" dropdown="true" field="label" emptyMessage="No results found"
          (completeMethod)="onAutoCompleteSearch($event.query, 'carrierSegmentList', 'carrierSegmentFilteredList')"
          (onClear)="onAutoCompleteClear($event.target['value'], 'carrierSegment')" (onSelect)="onCarrierSegmentSelect($event)"
          data-attr="carrierdetails-section-carriersegment-autocomplete"></p-autoComplete>
          <label for="carrierSegment">Carrier Segment</label>
          <div [ngClass]="{'message-height': createSectionModel.carrierSectionForm.get('carrierSegment').touched && createSectionModel.carrierSectionForm.get('carrierSegment')['errors']?.required}">
            <p-message severity="error" text="Provide Carrier Segment"
            *ngIf="createSectionModel.carrierSectionForm.get('carrierSegment').touched && createSectionModel.carrierSectionForm.get('carrierSegment')['errors']?.required"></p-message>
          </div>
        </span>
        <span class="ui-float-label ui-md-6 ui-lg-6 ui-g-6 typeahead-float-nested-label pad-right0">
          <p-autoComplete formControlName="businessUnit" name="businessUnit" [suggestions]="createSectionModel.buFilteredList"
          (completeMethod)="onAutoCompleteSearch($event.query, 'buList', 'buFilteredList')" field="label" dropdown="true"
          size="70" [forceSelection]="true" spellcheck="false" (onClear)="onAutoCompleteClear($event.target['value'], 'businessUnit')"
          emptyMessage="No results found" data-attr="carrierdetails-section-businessUnit-autocomplete"></p-autoComplete>
          <label class="ui-md-12 ui-lg-12 ui-g-12 pad0" for="businessUnit">
            <span>Business Unit</span>
            <span class="pull-right optional-label">optional</span>
          </label>
        </span>
      </div>
      <div class="ui-g-12 ui-md-12 ui-lg-12 pad-left0 mar-top10 pad-right0">
        <span class="ui-float-label ui-g-12 ui-md-12 ui-lg-12 text-field-float pad-left0 pad-right0">
          <input type="text" pInputText formControlName="sectionName" name="sectionName" maxlength="80" spellcheck="false" autocomplete="off"
          data-attr="carrierdetails-section-sectionName-inputfield"/>
          <label class="top-5" for="sectionName">Section Name</label>
          <div [ngClass]="{'message-height': createSectionModel.carrierSectionForm.get('sectionName').touched && createSectionModel.carrierSectionForm.get('sectionName')['errors']?.required}">
            <p-message severity="error" text="Provide Section Name" *ngIf="createSectionModel.carrierSectionForm.get('sectionName').touched &&
            createSectionModel.carrierSectionForm.get('sectionName')['errors']?.required"></p-message>
          </div>
        </span>
      </div>
      <div class="ui-g-12 ui-md-12 ui-lg-12 pad-left0 mar-top10 pad-right0">
        <span class="ui-float-label ui-md-6 ui-lg-6 ui-g-6 date-field-float pad-left0">
          <p-calendar formControlName="effectiveDate" [showIcon]="true" name="effectiveDate" appendTo="body"
            [maxDate]="createSectionModel.effectiveMaxDate"
            (onInput)="onTypeDate($event.srcElement['value'], 'effective')" (onSelect)="onDateSelected($event, 0)"
            [showOnFocus]="true" data-attr="carrierdetails-section-effectiveDate-calendarfield"></p-calendar>
          <label for="effectiveDate" class="leftPlace">Effective Date</label>
          <div [ngClass]="{'message-height': createSectionModel.carrierSectionForm.get('effectiveDate').touched && createSectionModel.carrierSectionForm.get('effectiveDate')['errors']}">
            <p-message severity="error" text="Provide Effective Date" *ngIf="createSectionModel.carrierSectionForm.get('effectiveDate').touched &&
            createSectionModel.carrierSectionForm.get('effectiveDate')['errors']?.required"></p-message>
            <p-message severity="error" text="Provide a valid date" *ngIf="createSectionModel.carrierSectionForm.get('effectiveDate').touched &&
            createSectionModel.carrierSectionForm.get('effectiveDate')['errors']?.invalid"></p-message>
          </div>
        </span>
        <span class="ui-float-label ui-md-6 ui-lg-6 ui-g-6 date-field-float pad-right0">
          <p-calendar formControlName="expirationDate" [showIcon]="true" name="expirationDate" appendTo="body"
            panelStyleClass="" [minDate]="createSectionModel.expirationMinDate"
            [showOnFocus]="true" data-attr="carrierdetails-section-expirationDate-calendarfield"
            (onInput)="onTypeDate($event.srcElement['value'], 'expiration')" (onSelect)="onDateSelected($event, 1)"></p-calendar>
          <label for="expirationDate" class="leftPlace">Expiration Date</label>
          <div [ngClass]="{'message-height': createSectionModel.carrierSectionForm.get('expirationDate').touched && createSectionModel.carrierSectionForm.get('expirationDate')['errors']}">
            <p-message severity="error" text="Provide Expiration Date" *ngIf="createSectionModel.carrierSectionForm.get('expirationDate').touched &&
            createSectionModel.carrierSectionForm.get('expirationDate')['errors']?.required"></p-message>
            <p-message severity="error" text="Provide a valid date" *ngIf="createSectionModel.carrierSectionForm.get('expirationDate').touched &&
            createSectionModel.carrierSectionForm.get('expirationDate')['errors']?.invalid"></p-message>
          </div>
        </span>
      </div>
      <div class="ui-g-12 ui-md-12 ui-lg-12 pad-left0 mar-top10 pad-right0">
        <span class="ui-float-label ui-g-12 ui-md-12 ui-lg-12 typeahead-float-nested-label pad-left0 pad-right0">
          <p-autoComplete formControlName="account" name="account" [suggestions]="createSectionModel.accountList" [style]="{'width': '100%'}"
          size="100" [forceSelection]="true" spellcheck="false" dropdown="true" field="label" emptyMessage="No results found"
          (completeMethod)="onAccountSearch($event.query)" data-attr="carrierdetails-section-account-autocomplete" dropdownMode="current"
          (onClear)="onAutoCompleteClear($event.target['value'], 'account')" (onSelect)="onAccountSelect($event)"></p-autoComplete>
          <label class="ui-md-12 ui-lg-12 ui-g-12 pad0" for="account">
            <span>Find Account</span>
            <span class="pull-right mar-right35">optional</span>
          </label>
        </span>
      </div>
      <div class="ui-g-12 ui-md-12 ui-lg-12 pad-left0 mar-top10 pad-right0">
        <span class="ui-md-12 ui-lg-12 ui-g-12 pad-left0 pad-right0">
          <p-table #codestable [value]="createSectionModel.filteredCodesList" [(selection)]="createSectionModel.selectedCodesList"
          [scrollable]="false" [columns]="createSectionModel.codesTableColumns" [loading]="createSectionModel.isBillToLoading"
          (onHeaderCheckboxToggle)="createSectionModel.carrierSectionForm.markAsDirty()" [resizableColumns]="true"
          (onRowSelect)="createSectionModel.carrierSectionForm.markAsDirty()" columnResizeMode="expand"
          (onRowUnselect)="createSectionModel.carrierSectionForm.markAsDirty()" datakey="billToDisplay"
          [globalFilterFields]="['billToDisplay', 'assignment']" [filterDelay]="0" class="billto-table" (onFilter)="onFilter()">
            <ng-template pTemplate="caption">
              <div class="ui-g codes-table-caption">
                <div class="ui-md-6 ui-lg-6">
                  <span class="tableName">Bill To Accounts
                    {{(createSectionModel.billToCount > 0) ? '(' +
                    createSectionModel.billToCount + ')' : ''}}</span>
                </div>
                <div class="ui-md-6 ui-lg-6">
                  <div class="searchHolder">
                    <div class="ui-inputgroup search-field">
                      <span class="ui-inputgroup-addon">
                        <em class="icon-Search"></em>
                      </span>
                      <input id="codeSearchText" appShortcut="" autocomplete="off" [ngModelOptions]="{standalone: true}"
                        type="text" pInputText placeholder="Search" [(ngModel)]="createSectionModel.searchInputValue" spellcheck="false" autocomplete="off"
                        (input)="codestable.filterGlobal($event.target.value, 'contains');createSectionModel.isBillToLoading = true;"
                        data-attr="carrierdetails-section-billto-search">
                    </div>
                  </div>
                </div>
              </div>
            </ng-template>
            <ng-template pTemplate="colgroup" let-columns>
              <colgroup *ngIf="createSectionModel?.filteredCodesList.length > 0">
                <col>
                <col *ngFor="let thisCol of createSectionModel.codesTableColumns">
              </colgroup>
            </ng-template>
            <ng-template pTemplate="header">
              <tr *ngIf="createSectionModel?.filteredCodesList.length === 0">
                <td colspan="2" class="align-emptymessage">
                  <div *ngIf="!createSectionModel.isBillToLoading">
                    <h4 class="billto-emptyMsgText">Please search an account above to view all Bill To Accounts</h4>
                  </div>
                </td>
              </tr>
              <tr class="pad0 mar0" *ngIf="createSectionModel?.filteredCodesList.length > 0">
                <th class="checkbox-column table-header-checkbox">
                  <p-tableHeaderCheckbox appShortcut focusKey="alt+1"></p-tableHeaderCheckbox>
                </th>
                <th *ngFor="let thisCol of createSectionModel?.codesTableColumns" pResizableColumn
                  [pSortableColumn]="thisCol.key" pTooltip={{thisCol.label}} tooltipPosition="top" class="table-header">
                  {{thisCol.label}}
                  <span>
                    <p-sortIcon [field]="thisCol.key" aria-label="Activate to sort" aria-labelDesc="Activate to sort in descending order"
                      aria-labelAsc="Activate to sort in ascending order"></p-sortIcon>
                  </span>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowData let-data let-rowIndex="rowIndex">
              <tr [pSelectableRow]="rowData">
                <td class="checkbox-column width10">
                  <p-tableCheckbox [value]="rowData"></p-tableCheckbox>
                </td>
                <td *ngFor="let thisCol of createSectionModel.codesTableColumns" pTooltip={{data[thisCol.key]}} 
                tooltipPosition="top" class="ui-resizable-column">
                  <span class="capitalize-first-word">{{ data[thisCol.key] }}</span>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </span>
      </div>
    </form>
  </div>
  <div class="split-footer">
    <span class="pull-right mar-top12">
      <button type="text" pButton label="Cancel" class="ui-button-secondary mar-right15" (click)="onClickCancel()"></button>
      <button type="text" pButton label="Save" class="ui-button-primary mar-right15" (click)="onClickSave()"></button>
    </span>
  </div>
</div>
<p-dialog [(visible)]="createSectionModel.isShowPopup" [modal]="true" [responsive]="true" [width]="350" [minWidth]="200"
  [minY]="70" [baseZIndex]="10005" [closable]="false">
  <p-header>
    <span class="capitalizeTitle">Confirmation</span>
    <a [ngClass]="{'ui-dialog-titlebar-icon ui-dialog-titlebar-close ui-corner-all':true}" href="javascript:void(0)"
      role="button" (click)="popupCancel()">
      <span class="pi pi-times"></span>
    </a>
  </p-header>
  <span>You are about to lose all the changes. Do you want to proceed?</span>
  <p-footer>
    <button type="button" pButton (click)="popupCancel()" class="ui-button-secondary" label="No" data-attr="carrierdetail-section-popupno-button"></button>
    <button type="button" pButton (click)="cancelSplitView()" label="Yes" class="ui-button-primary" data-attr="carrierdetail-section-popupyes-button"></button>
  </p-footer>
</p-dialog>